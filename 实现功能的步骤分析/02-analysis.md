---
title: 实现功能步骤分析-02
typora-copy-images-to: media
---

    
##        (1) 实现分页数据显示在comments.html评论页面

-           ① 在comments.html页面全部样式加载完毕之后,发送请求,参数为页码$pageindex和每页容量$pageSize
            ② getComments.php获取到提交过来的页码和每页容量(返回每页的数据和总页数)
                a.要返回每页的数据:连接数据库分页查询(limit 从第几条开始  每页容量)
                  从第几条开始: (页码-1)*每页容量
                b.要返回总页数:查询数据库,求出评论总数
                  总页数=评轮总数/每页容量
            ③ comments.html页面接收到响应体,将响应体中的每页数据填充模板,以及响应体中的总页数填充页码li模板

##        (2) 实现点击页码,显示当前页的数据

-            每点击一个页码都要发送请求接收响应体,所以将发送请求接收
            响应体的代码封装成函数,页码不能写死,将页码作为参数
            因为页码是后面才生成的，不能一开始直接加点击事件，只能在模板给它加行内点击事件，行内里调用loadData函数，并传入自己的索引
            ① 在页码的模板中,li包含a标签,href属性值为JavaScript:发送请求的函数(参数为模板的i即当前点击的页码)  
               这样点击每一个页码都会请求响应页的数据显示到页面上

##        (3) 实现点击当前页码li高亮显示

-            ① 在页码模板中判断,如果点击的是当前页码(i==currentPage)),就高亮显示
            ② currentPage在填充模板时传入 currentPage:page     page是函数的参数即发送请求的页码

##        (4) 实现点击上一页和下一页会切换页面数据

-            点击上一页和上一页都需要发送请求页面数据
            ① 在页码模板中,上一页和下一页的a标签的href属性值为JavaScript:发送请求的函数(参数为当前页码currentPage-1或者+1)
            ② 判断如果当前页码是第一页,点击上一页就转到最后一页;否则就currentPage-1
            ③ 判断如果当前页码是最后一页,点击下一页就转到第一页;否则就currentPage+1


##        (5) 实现选框的全选全不选和反选

-            ① 全选和全不选: tbody选框的状态和thead选框的状态一样,全选的时候批量操作显示,全不选的时候,批量操作隐藏
            ② 反选,当tbody的全部选框都选中,thead的选框才选中
             即tbody中选中的选框数=tbody的选框总数,thead中的选框才选中
             所以,需要给tbody的每一个选框都添加一个点击事件
            然而在绑定点击事件的时候可能页面数据的请求还没有完成,所以要用委托事件,给父级添加点击事件
            $('tbody').on('click',':checkbox',function(){
                ...
                还需要判断,当tbody的选中的选框数>0,就要显示批量操作,否则隐藏
            })

##        (6) 实现每条数据后面的点击删除,驳回,批准按钮的操作

-            这三个操作都使用同一个接口updateComment.php,所不同的是需要执行的操作(要修改评论状态)
            所以,提交参数为 所点击这条数据的id和修改评论状态为status
            ① 由于每条数据后面都有按钮,点击每个按钮都需要发送一次请求,所以将该请求封装成函数,参数为修改评论状态为什么status和该条数据的id
            ② 在点击按钮的a标签的href属性=JavaScript:函数
            ③ 操作执行成功,需要局部刷新(即重新显示数据),再调用loadData-->页面数据请求的函数
            ④ loadData(参数) 参数为操作的当前页面的页码
             解决: 定义一个全局变量存储当前页面的页码,在loadData函数中给这个全局变量赋值,即可拿到当前页面的页码


##        (7) 实现批量操作

-            批量操作使用和(6)同一个接口,提交参数为status和批量操作的id
            因为无论是单行修改，还是多个修改，都可以用
            update ...where id in (一个id或者多个id)
            例： update comments set status='approved' where id in (10,11)
            ① 有三个批量操作,所以将批量操作的请求封装成函数,只有一个参数为status
            ② 需要找到批量操作的id(即tbody中选中的选框的id)
              解决: 在页面数据模板中,给选框添加一个value行内属性,存储该行的id
            ③ 将tbody中选中的选框的id取出来,为x,x,x的格式
                遍历tbody的选中的选框
                var str='';
                $('tbody :checked').each(function(index,ele){
                    //ele.value  就是选中的该行的id
                    //用str拼接 结果为x,x,x,的格式,需要将最后的一个逗号去除,用字符串的substr方法
                })
                str=str.substr(从哪个下标开始截取,到哪个下标结束)
                ids=str.substr(0,str.length-1)
            ④ 将求得的ids作为参数提交到服务器
             

    
   